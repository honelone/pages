import{_ as B,o as M,a as R,b as s,d as oe,c as te,r as J,k as le,t as Y,x as V,q as ae,m as re}from"./index-D3906Olc.js";function ie(){let S={screenSize:[13,20],intervals:1e3},r,T,h=0;const $=new Map;let m=!0,E=null,O=null,x="",j="",y=[0,0],p=new Set;const c="bg";let G=0,l=()=>{};const H=["I","L","J","Z","S","T","O"],Q={I:[[1,1,1,1]],L:[[1,1,1],[1,0,0]],J:[[1,1,1],[0,0,1]],Z:[[1,1,0],[0,1,1]],S:[[0,1,1],[1,1,0]],T:[[1,1,1],[0,1,0]],O:[[1,1],[1,1]]},_=function(e={}){F(e)};_.create=(e={})=>new _(e),_.prototype={get map(){return[...$.values()]},get status(){return h},get isPause(){return m},get score(){return G},get nextShap(){return{type:j,shapData:O}}},_.prototype.ready=function(){console.log("ready: "),h===0&&(X(),K(),h=1)},_.prototype.play=function(){h===1&&(h=2),m&&(m=!1,U())},_.prototype.pause=function(){m=!0},_.prototype.over=function(){h=3},_.prototype.again=function(e={}){F(e),this.ready()},_.prototype.update=function(e){l=e},_.prototype.action=function(e){const[t,o]=y;h!==2||m||(e==="left"?A([t-1,o]):e==="right"?A([t+1,o]):e==="lower"?A([t,o+1],!0):e==="change"&&q())};const F=(e={})=>{S={...S,...e},r=S.screenSize,T=S.intervals,y=[0,0],p=new Set,h=0,G=0,m=!0;const{datas:t,index:o}=W();O=t,j=o},X=()=>{const[e,t]=r;for(let o=0;o<t;o++)for(let a=0;a<e;a++){const i=[a,o];$.set(z(i),{type:c,vector:i})}},K=()=>{const[e]=r;E=O,x=j,y=[Math.floor(e/2)-(!(e&1)&&x==="I"?2:1),0];const t=w(y);n(t,x,!1);const{datas:o,index:a}=W();O=o,j=a,k(t)&&(h=3),l()},U=()=>{if(!(m||h===3)){if(h===2){const[e,t]=y;A([e,t+1],!0)}setTimeout(()=>{U()},T)}},W=()=>{const e=Math.random()*H.length<<0,t=H[e];return{index:t,datas:Q[t]}},A=([e,t],o=!1)=>{const a=w([e,t]);if(o===!0&&I([e,t])){N(),K();return}Z(a)||g(a)||D([e,t])},D=e=>{let t=w(y);n(t,c),t=w(e),n(t,x),y=e,l()},n=(e,t,o=!0)=>{e.forEach(a=>{const i=z(a);!o&&$.get(i).type!==c||$.set(i,{type:t,vector:a})})},N=()=>{const e=L();P(e)},L=()=>{const[e,t]=r,o=[];for(let a=t-1;a>=0;a--){let i=!0;for(let u=0;u<e;u++)if($.get(z([u,a])).type===c){i=!1;break}i&&o.push(a)}return G+=o.length,o},w=([e,t],o=E)=>{const a=o.length,i=o[0].length,u=[];for(let f=0;f<a;f++)for(let d=0;d<i;d++)if(o[f][d]===1){let C=[d+e,f+t];x==="I"&&a>=4?C=[d+e+1,f+t-1]:x==="O"&&(C[0]+=1),u.push(C)}return u},P=e=>{const[t]=r;b([...e]).forEach(a=>{for(let i=a;i>=0;i--)for(let u=0;u<t;u++){if(i===a){const ee=z([u,i]);$.set(ee,{type:c,vector:[u,i]}),p.delete(ee);continue}const f=z([u,i]),d=z([u,i+1]),C=$.get(f),se=$.get(d);C.type!==c&&se.type===c&&($.set(f,{type:c,vector:[u,i]}),$.set(d,{type:C.type,vector:[u,i+1]}),p.delete(f),p.add(d))}})},q=()=>{const e=ne(E),t=w(y,e);Z(t)||g(t)||(n(w(y),c),n(t,x),E=e,l())},I=e=>{const t=w(e);if(Z(t)||g(t)){const o=w(y).map(a=>z(a));return p=new Set([...p,...o]),!0}return!1},Z=e=>{const[t,o]=r;return e.some(([a,i])=>a<0||a>=t||i>=o)},g=e=>e.some(t=>p.has(z(t))),k=e=>{const[,t]=y;return!!(t<=0&&g(e))},b=(e,t=[])=>{if(e.length<=0)return t;const o=Math.min(...e),a=e.indexOf(o);return t.push(e.splice(a,1)[0]),b(e,t)},ne=(e,t=!0)=>{const o=e[0].length,a=e.length,i=o-1,u=a-1,f=[];for(let d=0;d<o;d++){f[d]=[];for(let C=0;C<a;C++){if(t){f[d].push(e[u-C][d]);continue}f[d].push(e[C][i-d])}}return f},z=([e,t])=>`${e}_${t}`;return _}const ce={},ue={xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",viewBox:"0 0 24 24"};function de(S,r){return M(),R("svg",ue,r[0]||(r[0]=[s("path",{fill:"currentColor",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"M6.906 4.537A.6.6 0 0 0 6 5.053v13.894a.6.6 0 0 0 .906.516l11.723-6.947a.6.6 0 0 0 0-1.032z"},null,-1)]))}const pe=B(ce,[["render",de]]),he={},fe={xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",viewBox:"0 0 24 24"};function ve(S,r){return M(),R("svg",fe,r[0]||(r[0]=[s("path",{fill:"currentColor",d:"M8 19c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2s-2 .9-2 2v10c0 1.1.9 2 2 2m6-12v10c0 1.1.9 2 2 2s2-.9 2-2V7c0-1.1-.9-2-2-2s-2 .9-2 2"},null,-1)]))}const we=B(he,[["render",ve]]),ge={},me={xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",viewBox:"0 0 48 48"};function xe(S,r){return M(),R("svg",me,r[0]||(r[0]=[s("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"4",d:"M31 36L19 24l12-12"},null,-1)]))}const ye=B(ge,[["render",xe]]),_e={},Se={xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",viewBox:"0 0 48 48"};function $e(S,r){return M(),R("svg",Se,r[0]||(r[0]=[s("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"4",d:"m19 12l12 12l-12 12"},null,-1)]))}const ke=B(_e,[["render",$e]]),Ce={},Me={xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",viewBox:"0 0 256 256"};function Re(S,r){return M(),R("svg",Me,r[0]||(r[0]=[s("path",{fill:"currentColor",d:"m208.49 152.49l-72 72a12 12 0 0 1-17 0l-72-72a12 12 0 0 1 17-17L116 187V40a12 12 0 0 1 24 0v147l51.51-51.52a12 12 0 0 1 17 17Z"},null,-1)]))}const De=B(Ce,[["render",Re]]),Ie={},be={xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",viewBox:"0 0 24 24"};function Te(S,r){return M(),R("svg",be,r[0]||(r[0]=[s("g",{fill:"none"},[s("path",{d:"M24 0v24H0V0zM12.594 23.258l-.012.002l-.071.035l-.02.004l-.014-.004l-.071-.036q-.016-.004-.024.006l-.004.01l-.017.428l.005.02l.01.013l.104.074l.015.004l.012-.004l.104-.074l.012-.016l.004-.017l-.017-.427q-.004-.016-.016-.018m.264-.113l-.014.002l-.184.093l-.01.01l-.003.011l.018.43l.005.012l.008.008l.201.092q.019.005.029-.008l.004-.014l-.034-.614q-.005-.018-.02-.022m-.715.002a.02.02 0 0 0-.027.006l-.006.014l-.034.614q.001.018.017.024l.015-.002l.201-.093l.01-.008l.003-.011l.018-.43l-.003-.012l-.01-.01z"}),s("path",{fill:"currentColor",d:"M5.631 7.23a1.5 1.5 0 0 1 1.967-.446l.122.077l1.566 1.097a1.497 1.497 0 0 1 .5 2.048l-.078.118l-1.128 1.612a1.5 1.5 0 0 1-2.648-.373a7 7 0 0 0-.73.305a3.3 3.3 0 0 0-.553.332c.27.209.746.46 1.461.698c1.439.48 3.521.802 5.89.802s4.451-.322 5.89-.802c.716-.239 1.193-.49 1.462-.7l-.135-.095a4 4 0 0 0-.305-.178c-.686-.36-1.764-.702-3.157-.933a1.5 1.5 0 0 1 .49-2.96c1.57.26 2.992.674 4.066 1.24c.946.498 2.189 1.427 2.189 2.928c0 1.07-.652 1.852-1.279 2.346c-.643.507-1.481.898-2.383 1.198c-1.819.607-4.236.956-6.838.956s-5.02-.35-6.838-.956c-.902-.3-1.74-.691-2.383-1.198C2.152 13.852 1.5 13.07 1.5 12c0-.8.371-1.448.808-1.916c.43-.46.986-.82 1.567-1.107c.451-.223.96-.421 1.514-.595A1.5 1.5 0 0 1 5.63 7.23ZM12 3.5a1.5 1.5 0 0 1 1.493 1.356L13.5 5v7h-3V5A1.5 1.5 0 0 1 12 3.5M10.5 18v1a1.5 1.5 0 0 0 3 0v-1z"})],-1)]))}const ze=B(Ie,[["render",Te]]),Be={},Le={xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",viewBox:"0 0 20 20"};function Ve(S,r){return M(),R("svg",Le,r[0]||(r[0]=[s("g",{fill:"currentColor"},[s("path",{d:"M13.937 4.211a1 1 0 0 1-1.126 1.653A5 5 0 1 0 15 10a1 1 0 1 1 2 0a7 7 0 1 1-3.063-5.789"}),s("path",{d:"M13.539 12.506a1 1 0 1 1-1.078-1.685l3.482-2.227a1 1 0 0 1 1.077 1.685z"}),s("path",{d:"M18.903 12.41a1 1 0 0 1-1.826.815l-1.508-3.38a1 1 0 1 1 1.826-.815z"})],-1)]))}const Ee=B(Be,[["render",Ve]]),Oe={class:"tetris-wrapper"},je={class:"inner-wrapper"},Ae={class:"tetris-content"},Ne={class:"info"},Pe={class:"next-box"},qe={class:"score"},Je={class:"status"},Ge={key:0,class:"mask"},He={class:"tetris-actions"},v=18,Ze=oe({__name:"index",setup(S){re(D=>({"75d9812f":$.value}));const r=ie(),T=[13,20],h=[5,2],$=te(()=>T[0]*v+24*2+"px"),m=J(),E=()=>{m.value.style.width=`${h[0]*v}px`,m.value.style.height=`${h[1]*v}px`},O=D=>{const n=document.createElement("div"),{type:N,shapData:L}=D,[w,P]=h,q=new Set,I=L.length,Z=L[0].length;n.style.width=`${w*v}px`,n.style.height=`${P*v}px`,m.value.innerHTML=null;for(let g=0;g<I;g++)for(let k=0;k<Z;k++)L[g][k]===1&&q.add(`${N==="O"?k+1:k}_${g}`);for(let g=0;g<P;g++)for(let k=0;k<w;k++){const b=document.createElement("div");b.style.width=b.style.height=`${v}px`,b.style.left=`${k*v}px`,b.style.top=`${g*v}px`,b.setAttribute("class",`rect rect-${q.has(`${k-1}_${g}`)?N:"bg"}`),n.appendChild(b)}m.value.appendChild(n)},x=J(),j=()=>{x.value.style.width=`${T[0]*v}px`,x.value.style.height=`${T[1]*v}px`},y=D=>{console.log("renderGame data: ",D);const n=document.createElement("div"),[N,L]=T;x.value.innerHTML=null,n.style.width=`${N*v}px`,n.style.height=`${L*v}px`,D.forEach(w=>{const[P,q]=w.vector,I=document.createElement("div");I.style.width=I.style.height=`${v}px`,I.style.left=`${P*v}px`,I.style.top=`${q*v}px`,I.setAttribute("class",`rect rect-${w.type}`),n.appendChild(I)}),x.value.appendChild(n)},p=J(-1),c=J(!1),G=te(()=>c.value?"暂停了":p.value<=1?"请开始游戏":p.value==2?"正在游戏中":p.value==3?"结束了":""),l=J(),H=J(0),Q=()=>{l.value=new r({screenSize:T,intervals:1e3}),console.log(l.value),l.value.update(()=>{y(l.value.map),O(l.value.nextShap),H.value=l.value.score,p.value=l.value.status}),l.value&&document.addEventListener("keydown",D=>{const{keyCode:n}=D;n===37?l.value.action("left"):n===39?l.value.action("right"):n===38?l.value.action("change"):n===40&&l.value.action("lower")})},_=()=>{if(c.value)c.value=!1,l.value.play();else{if(l.value.ready(),c.value=!1,l.value.status!==1&&l.value.status!==2)return;l.value.play()}},F=()=>{l.value.status===2&&(l.value.pause(),c.value=!0)},X=()=>{l.value.over(),p.value=l.value.status,c.value=!1,l.value.again()},K=()=>{l.value.action("left")},U=()=>{l.value.action("right")},W=()=>{l.value.action("change")},A=()=>{l.value.action("lower")};return le(()=>{E(),j(),Q(),console.log("TJS.value: ",l.value)}),(D,n)=>(M(),R("div",Oe,[s("div",je,[s("div",Ae,[s("div",{class:"tetris-container",ref_key:"tetrisContainerRef",ref:x},null,512),s("div",Ne,[n[3]||(n[3]=s("div",{class:"next"},"下一个",-1)),s("div",Pe,[s("div",{class:"next-shape",ref_key:"nextShapeRef",ref:m},null,512)]),n[4]||(n[4]=s("div",{class:"score_title"},"得分",-1)),s("div",qe,Y(H.value),1),n[5]||(n[5]=s("div",{class:"status_title"},"状态",-1)),s("div",Je,Y(p.value),1),p.value<=1||c.value?(M(),R("div",{key:0,class:"action-item play",onClick:_},[V(pe),n[0]||(n[0]=s("span",{class:"label"},"开始",-1))])):(M(),R("div",{key:1,class:"action-item pause",onClick:F},[V(we),n[1]||(n[1]=s("span",{class:"label"},"暂停",-1))])),s("div",{class:"action-item again",onClick:X},[V(Ee),n[2]||(n[2]=s("span",{class:"label"},"重玩",-1))])]),p.value!==2||c.value?(M(),R("div",Ge,Y(G.value),1)):ae("",!0)]),s("div",He,[s("div",{class:"left",onClick:K},[V(ye),n[6]||(n[6]=s("span",{class:"label"},"左移",-1))]),s("div",{class:"right",onClick:U},[V(ke),n[7]||(n[7]=s("span",{class:"label"},"右移",-1))]),s("div",{class:"down",onClick:A},[V(De),n[8]||(n[8]=s("span",{class:"label"},"下移",-1))]),s("div",{class:"rotate",onClick:W},[V(ze),n[9]||(n[9]=s("span",{class:"label"},"旋转",-1))])])])]))}}),Ke=B(Ze,[["__scopeId","data-v-41a228d8"]]);export{Ke as default};
